import pandas as pd
import plotly.express as px
from io import StringIO

# Table string
table_string = """
tensor;nnz;sparsity;mean;variance;outlier_threshold;compression_rate
mlp.down_proj;1978493;0.956120;0.1250;0.0008;0.1000;0.9766043424606323
mlp.down_proj;1501963;0.966689;0.1250;0.0008;0.1350;0.9752424955368042
mlp.down_proj;1189839;0.973611;0.1250;0.0008;0.1700;0.9758955240249634
mlp.down_proj;956054;0.978796;0.1250;0.0009;0.2050;0.9768931865692139
mlp.down_proj;759058;0.983165;0.1250;0.0009;0.2400;0.9781039953231812
mlp.down_proj;596066;0.986780;0.1250;0.0009;0.2750;0.9793106317520142
mlp.down_proj;465062;0.989686;0.1250;0.0010;0.3100;0.9803918600082397
mlp.down_proj;361540;0.991982;0.1250;0.0010;0.3450;0.9813017249107361
mlp.down_proj;281086;0.993766;0.1250;0.0010;0.3800;0.9820448756217957
mlp.down_proj;219274;0.995137;0.1250;0.0010;0.4150;0.9826443195343018
mlp.gate_proj;1892633;0.958024;0.1250;0.0008;0.1000;0.9753565192222595
mlp.gate_proj;1481935;0.967133;0.1250;0.0008;0.1350;0.9742400050163269
mlp.gate_proj;1196899;0.973455;0.1250;0.0008;0.1700;0.9750589728355408
mlp.gate_proj;979141;0.978284;0.1250;0.0008;0.2050;0.9760774970054626
mlp.gate_proj;785817;0.982572;0.1250;0.0009;0.2400;0.9774161577224731
mlp.gate_proj;622005;0.986205;0.1250;0.0009;0.2750;0.9787032604217529
mlp.gate_proj;487461;0.989189;0.1250;0.0009;0.3100;0.979863703250885
mlp.gate_proj;378960;0.991595;0.1250;0.0010;0.3450;0.9808428883552551
mlp.gate_proj;293679;0.993487;0.1250;0.0010;0.3800;0.9816677570343018
mlp.gate_proj;227493;0.994955;0.1250;0.0010;0.4150;0.9823284149169922
mlp.up_proj;1893247;0.958011;0.1250;0.0008;0.1000;0.9753239154815674
mlp.up_proj;1490481;0.966943;0.1250;0.0008;0.1350;0.9741941690444946
mlp.up_proj;1212673;0.973105;0.1250;0.0008;0.1700;0.9749701023101807
mlp.up_proj;999353;0.977836;0.1250;0.0008;0.2050;0.9759654998779297
mlp.up_proj;806311;0.982117;0.1250;0.0009;0.2400;0.9773398637771606
mlp.up_proj;640596;0.985793;0.1250;0.0009;0.2750;0.978681206703186
mlp.up_proj;501605;0.988875;0.1250;0.0009;0.3100;0.9798953533172607
mlp.up_proj;388298;0.991388;0.1250;0.0010;0.3450;0.9809424877166748
mlp.up_proj;299158;0.993365;0.1250;0.0010;0.3800;0.9818180799484253
mlp.up_proj;229891;0.994901;0.1250;0.0010;0.4150;0.9825432300567627
self_attn.k_proj;120812;0.992799;0.1250;0.0014;0.1000;0.9930995106697083
self_attn.k_proj;90146;0.994627;0.1250;0.0013;0.1350;0.9899581074714661
self_attn.k_proj;70059;0.995824;0.1250;0.0012;0.1700;0.988278329372406
self_attn.k_proj;56020;0.996661;0.1250;0.0012;0.2050;0.9869728088378906
self_attn.k_proj;46102;0.997252;0.1250;0.0011;0.2400;0.9860946536064148
self_attn.k_proj;38390;0.997712;0.1250;0.0011;0.2750;0.9854172468185425
self_attn.k_proj;33449;0.998006;0.1250;0.0011;0.3100;0.9848798513412476
self_attn.k_proj;29628;0.998234;0.1250;0.0011;0.3450;0.984451174736023
self_attn.k_proj;26390;0.998427;0.1250;0.0011;0.3800;0.9841384291648865
self_attn.k_proj;23843;0.998579;0.1250;0.0011;0.4150;0.9838931560516357
self_attn.o_proj;729291;0.956531;0.1250;0.0012;0.1000;0.9896144866943359
self_attn.o_proj;559368;0.966659;0.1250;0.0012;0.1350;0.9883766174316406
self_attn.o_proj;441789;0.973667;0.1250;0.0012;0.1700;0.9881083965301514
self_attn.o_proj;357409;0.978697;0.1250;0.0012;0.2050;0.9876517057418823
self_attn.o_proj;293473;0.982508;0.1250;0.0012;0.2400;0.9873273372650146
self_attn.o_proj;243323;0.985497;0.1250;0.0012;0.2750;0.9869879484176636
self_attn.o_proj;204830;0.987791;0.1250;0.0012;0.3100;0.9867342710494995
self_attn.o_proj;173661;0.989649;0.1250;0.0011;0.3450;0.9865438938140869
self_attn.o_proj;149281;0.991102;0.1250;0.0011;0.3800;0.9863780736923218
self_attn.o_proj;129437;0.992285;0.1250;0.0011;0.4150;0.9862449169158936
self_attn.q_proj;89914;0.994641;0.1250;0.0011;0.1000;0.9834344387054443
self_attn.q_proj;68484;0.995918;0.1250;0.0009;0.1350;0.9797937870025635
self_attn.q_proj;54791;0.996734;0.1250;0.0009;0.1700;0.9780094027519226
self_attn.q_proj;45161;0.997308;0.1250;0.0008;0.2050;0.976781964302063
self_attn.q_proj;38437;0.997709;0.1250;0.0008;0.2400;0.975926399230957
self_attn.q_proj;33194;0.998021;0.1250;0.0008;0.2750;0.9753624200820923
self_attn.q_proj;30182;0.998201;0.1250;0.0008;0.3100;0.9749488830566406
self_attn.q_proj;27231;0.998377;0.1250;0.0008;0.3450;0.9746115803718567
self_attn.q_proj;25085;0.998505;0.1250;0.0008;0.3800;0.974347710609436
self_attn.q_proj;24012;0.998569;0.1250;0.0008;0.4150;0.9741193056106567
self_attn.v_proj;843636;0.949715;0.1250;0.0011;0.1000;0.9849688410758972
self_attn.v_proj;617608;0.963188;0.1250;0.0010;0.1350;0.9833507537841797
self_attn.v_proj;478760;0.971464;0.1250;0.0011;0.1700;0.9837126731872559
self_attn.v_proj;385609;0.977016;0.1250;0.0011;0.2050;0.9842106103897095
self_attn.v_proj;317197;0.981094;0.1250;0.0011;0.2400;0.9848962426185608
self_attn.v_proj;266356;0.984124;0.1250;0.0011;0.2750;0.9854327440261841
self_attn.v_proj;226974;0.986471;0.1250;0.0011;0.3100;0.985955536365509
self_attn.v_proj;196296;0.988300;0.1250;0.0011;0.3450;0.9863674640655518
self_attn.v_proj;171437;0.989782;0.1250;0.0012;0.3800;0.9867373704910278
self_attn.v_proj;151486;0.990971;0.1250;0.0012;0.4150;0.9870549440383911
"""

# Load the data from the string
data = pd.read_csv(StringIO(table_string), sep=';')

# Create the plot
fig = px.line(
    data,
    x='sparsity',
    y='variance',
    color='tensor',
    title='Variance vs Sparsity at Layer 0',
    labels={'sparsity': 'Sparsity', 'variance': 'Variance'},
    markers=True
)

# Show the plot
fig.show()






